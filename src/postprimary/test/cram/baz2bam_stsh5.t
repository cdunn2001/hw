Extract sts.h5

  $ outPrefix="softball_snr-50"
  $ bazFile="/pbi/dept/primary/sim/spider/kestrel-test/prod.baz"
  $ baz2bam --fullHQ -o ${outPrefix} -m $TESTDIR/data/metadata.xml ${bazFile} --silent --whitelistZmwId=0-199 --enableBarcodedAdapters=False

Compare sts.h5

  $ stsTool ${outPrefix}.sts.h5 | head -5
  NumBases,ReadLength,Loading,Productivity,MedianInsertLength,InsertReadLength,ReadType,LoopOnly,ReadScore,HQRegionStart,HQRegionEnd,HQRegionStartTime,HQRegionEndTime,HQRegionScore,BaseRate,BaseWidth,BaseIpd,LocalBaseRate,NumPulses,PulseRate,PulseWidth,Pausiness,IsControl,ControlReadLength,ControlReadAccuracy,BaseFraction,HQRegionSnrMean,SnrMean,HQPkmid,InsertionCounts,InsertionLengths,HQBaselineLevel,HQBaselineStd,BaselineLevel,BaselineStd,DyeAngle,HQChannelMinSnr,HoleXY,HoleNumber,UnitFeature,HoleType
  1591,1591,1,1,4294967295,1591,1,0,0.8,0,1591,0,532,0.8,2.8264,0.210577,0.129843,2.93825,1538,2.88837,0.20602,0.000628536,0,4294967295,nan,0.2533/0.245129/0.249529/0.252043,654.625/1215.19/319.308/415.49,654.625/1215.19/319.308/415.49,13900.5/25803.8/6780.31/8822.66,1/0/0/0,1591/0/0/0,-3.63281,21.2344,-3.63281,21.2344,-1/-1/-1/-1,334.971,0/0,0,0,0
  1622,1622,1,1,4294967295,1622,1,0,0.8,0,1622,0,532,0.8,2.90903,0.200995,0.14427,2.89708,1578,2.96349,0.197199,0.000616523,0,4294967295,nan,0.251541/0.240444/0.260789/0.247226,404.348/698.475/192.117/267.975,404.348/698.475/192.117/267.975,13735.2/23726.3/6525.96/9102.78,1/0/0/0,1622/0/0/0,-1.72656,33.9688,-1.72656,33.9688,-1/-1/-1/-1,258.729,0/0,1,0,0
  1602,1602,1,1,4294967295,1602,1,0,0.8,0,1602,0,532,0.8,2.84706,0.209028,0.129843,2.95168,1546,2.9034,0.205104,0.00062422,0,4294967295,nan,0.25593/0.247191/0.250936/0.245943,502.991/852.816/224.122/289.969,502.991/852.816/224.122/289.969,14869.7/25211.4/6625.62/8572.21,1/0/0/0,1602/0/0/0,-2.78125,29.5625,-2.78125,29.5625,-1/-1/-1/-1,292.931,0/0,2,0,0
  1561,1561,1,1,4294967295,1561,1,0,0.8,0,1561,0,532,0.8,2.75128,0.216941,0.14427,2.76917,1500,2.81701,0.211897,0.000640615,0,4294967295,nan,0.266496/0.271621/0.222293/0.23959,1067.08/2165.83/377.497/587.521,1067.08/2165.83/377.497/587.521,15047.5/30541.6/5323.3/8284.97,1/0/0/0,1561/0/0/0,-3.63477,14.1016,-3.63477,14.1016,-1/-1/-1/-1,472.33,0/0,3,0,0
  $ stsTool ${outPrefix}.sts.h5 | tail -5
  1609,1609,1,1,4294967295,1609,1,0,0.8,0,1609,0,532,0.8,2.90903,0.199868,0.14427,2.90658,1575,2.95786,0.196661,0.000621504,0,4294967295,nan,0.244873/0.255438/0.255438/0.244251,780.431/1370.52/409.865/488.164,780.431/1370.52/409.865/488.164,13377.1/23491.5/7025.35/8367.44,1/0/0/0,1609/0/0/0,-3.12695,17.1406,-3.12695,17.1406,-1/-1/-1/-1,466.302,0/0,195,0,0
  1596,1596,1,1,4294967295,1596,1,0,0.8,0,1596,0,532,0.8,2.84518,0.205811,0.14427,2.85722,1545,2.90152,0.20183,0.000626566,0,4294967295,nan,0.234336/0.253759/0.254386/0.257519,818.864/1649.93/411.543/555.076,818.864/1649.93/411.543/555.076,12794.8/25780.2/6430.36/8673.06,1/0/0/0,1596/0/0/0,-3.42188,15.625,-3.42188,15.625,-1/-1/-1/-1,480.607,0/0,196,0,0
  1558,1558,1,1,4294967295,1558,1,0,0.8,0,1558,0,532,0.8,2.78133,0.216937,0.129843,2.88437,1509,2.83391,0.212918,0.000641849,0,4294967295,nan,0.249037/0.251605/0.252246/0.247112,349.234/733.069/171.22/230.691,349.234/733.069/171.22/230.691,13565.6/28475.2/6650.83/8960.91,1/0/0/0,1558/0/0/0,-3.39258,38.8438,-3.39258,38.8438,-1/-1/-1/-1,178.228,0/0,197,0,0
  1586,1586,1,1,4294967295,1586,1,0,0.8,0,1586,0,532,0.8,2.85832,0.21079,0.14427,2.81715,1545,2.90152,0.207658,0.000630517,0,4294967295,nan,0.245271/0.25662/0.24401/0.254098,1217.06/2027.95/489.487/781,1217.06/2027.95/489.487/781,15194.2/25317.7/6110.93/9750.3,1/0/0/0,1586/0/0/0,-3.73047,12.4844,-3.73047,12.4844,-1/-1/-1/-1,504.753,0/0,198,0,0
  1594,1594,1,1,4294967295,1594,1,0,0.8,0,1594,0,532,0.8,2.84142,0.210785,0.129843,2.93646,1539,2.89025,0.207142,0.000627353,0,4294967295,nan,0.260979/0.237139/0.250941/0.250941,466.041/764.654/220.844/251.232,466.041/764.654/220.844/251.232,14971.6/24564.5/7094.63/8070.83,1/0/0/0,1594/0/0/0,-inf,32.125,-inf,32.125,-1/-1/-1/-1,143.874,0/0,199,0,0

Extract sts.h5

  $ baz2bam -Q $TESTDIR/data/hqregions.fasta -o ${outPrefix}-2 -m $TESTDIR/data/metadata.xml ${bazFile} --silent  --whitelistZmwId=0-199 --enableBarcodedAdapters=False

Compare sts.h5

  $ stsTool ${outPrefix}-2.sts.h5 | head -5
  NumBases,ReadLength,Loading,Productivity,MedianInsertLength,InsertReadLength,ReadType,LoopOnly,ReadScore,HQRegionStart,HQRegionEnd,HQRegionStartTime,HQRegionEndTime,HQRegionScore,BaseRate,BaseWidth,BaseIpd,LocalBaseRate,NumPulses,PulseRate,PulseWidth,Pausiness,IsControl,ControlReadLength,ControlReadAccuracy,BaseFraction,HQRegionSnrMean,SnrMean,HQPkmid,InsertionCounts,InsertionLengths,HQBaselineLevel,HQBaselineStd,BaselineLevel,BaselineStd,DyeAngle,HQChannelMinSnr,HoleXY,HoleNumber,UnitFeature,HoleType
  1591,500,2,1,4294967295,500,3,0,0.8,500,1000,163,327,0.8,2.81372,0.211036,0.14427,2.81676,470,2.86865,0.206988,0,0,4294967295,nan,0.248/0.248/0.262/0.242,474.836/1153.45/288.408/353.603,654.625/1215.19/319.308/415.49,11522.2/27989.2/6998.4/8580.39,1/0/0/0,1591/0/0/0,-3.42578,24.2656,-3.63281,21.2344,-1/-1/-1/-1,408.122,0/0,0,0,0
  1622,500,2,1,4294967295,500,3,0,0.8,500,1000,163,327,0.8,2.96021,0.197235,0.14427,2.93069,488,2.97852,0.196009,0,0,4294967295,nan,0.274/0.242/0.258/0.226,393.072/649.383/177.519/226.63,404.348/698.475/192.117/267.975,14457.7/23885.1/6529.36/8335.74,1/0/0/0,1622/0/0/0,-1.41016,36.7812,-1.72656,33.9688,-1/-1/-1/-1,270.125,0/0,1,0,0
  1602,500,2,1,4294967295,500,3,0,0.8,500,1000,163,327,0.8,2.83813,0.216438,0.129843,2.89,477,2.91138,0.211177,0,0,4294967295,nan,0.236/0.23/0.25/0.284,446.161/773.703/227.097/339.101,502.991/852.816/224.122/289.969,13573.1/23537.5/6908.72/10316.1,1/0/0/0,1602/0/0/0,-2.11719,30.4219,-2.78125,29.5625,-1/-1/-1/-1,305.133,0/0,2,0,0
  1561,500,2,1,4294967295,500,3,0,0.8,500,1000,163,327,0.8,2.74658,0.220974,0.14427,2.74006,457,2.78931,0.21757,0,0,4294967295,nan,0.258/0.278/0.22/0.244,877.502/1839.17/310.605/615.244,1067.08/2165.83/377.497/587.521,13827.5/28981.3/4894.46/9694.9,1/0/0/0,1561/0/0/0,-3.26758,15.7578,-3.63477,14.1016,-1/-1/-1/-1,464.013,0/0,3,0,0
  $ stsTool ${outPrefix}-2.sts.h5 | tail -5
  1609,500,2,1,4294967295,500,3,0,0.8,500,1000,163,327,0.8,2.9541,0.19815,0.14427,2.92286,490,2.99072,0.195926,0,0,4294967295,nan,0.272/0.256/0.218/0.254,733.329/1105.29/296.267/386.18,780.431/1370.52/409.865/488.164,15342.6/23124.8/6198.46/8079.62,1/0/0/0,1609/0/0/0,-2.72656,20.9219,-3.12695,17.1406,-1/-1/-1/-1,483.638,0/0,195,0,0
  1596,500,2,1,4294967295,500,3,0,0.8,500,1000,163,327,0.8,2.74048,0.211449,0.158696,2.70396,458,2.79541,0.207386,0,0,4294967295,nan,0.252/0.26/0.26/0.228,726.677/1516.11/299.095/407.59,818.864/1649.93/411.543/555.076,13704.7/28593/5640.75/7686.9,1/0/0/0,1596/0/0/0,-3.06055,18.8594,-3.42188,15.625,-1/-1/-1/-1,552.279,0/0,196,0,0
  1558,500,2,1,4294967295,500,3,0,0.8,500,1000,163,327,0.8,2.87476,0.209992,0.14427,2.82508,480,2.92969,0.206083,0,0,4294967295,nan,0.262/0.238/0.268/0.232,308.448/656.613/130.681/166.309,349.234/733.069/171.22/230.691,14169.3/30163.2/6003.17/7639.81,1/0/0/0,1558/0/0/0,-2.60156,45.9375,-3.39258,38.8438,-1/-1/-1/-1,233.029,0/0,197,0,0
  1586,500,2,1,4294967295,500,3,0,0.8,500,1000,163,327,0.8,2.86865,0.214223,0.129843,2.90862,478,2.91748,0.210632,0,0,4294967295,nan,0.238/0.244/0.23/0.288,1038.49/1602.03/376.094/671.565,1217.06/2027.95/489.487/781,16437.3/25357.1/5952.87/10629.6,1/0/0/0,1586/0/0/0,-3.00195,15.8281,-3.73047,12.4844,-1/-1/-1/-1,488.123,0/0,198,0,0
  1594,500,2,1,4294967295,500,3,0,0.8,500,1000,163,327,0.8,2.75879,0.215302,0.129843,2.89952,462,2.81982,0.210525,0,0,4294967295,nan,0.26/0.226/0.252/0.262,383.245/626.364/165.695/226.545,466.041/764.654/220.844/251.232,14419.6/23566.9/6234.26/8523.75,1/0/0/0,1594/0/0/0,-3.00195,37.625,-inf,32.125,-1/-1/-1/-1,133.911,0/0,199,0,0

Run with diagnostic datasets turned on

  $ outPrefix="softball_snr-50_diag"
  $ baz2bam --fullHQ --diagStsH5 -o ${outPrefix} -m $TESTDIR/data/metadata.xml --adapters $TESTDIR/data/adapter.fasta ${bazFile} --silent --whitelistZmwId=0-199 --enableBarcodedAdapters=False

  $ h5ls ${outPrefix}.sts.h5/VsMF
  BaseRate                 Dataset {200, 15}
  BaseWidth                Dataset {200, 15}
  BaselineLevel            Dataset {200, 15, 1}
  BaselineStd              Dataset {200, 15, 1}
  NumFrames                Dataset {200, 15}
  Pkmid                    Dataset {200, 15, 4}
  PulseRate                Dataset {200, 15}
  PulseWidth               Dataset {200, 15}
  SnrMean                  Dataset {200, 15, 4}
  TraceAutoCorr            Dataset {200, 15}
