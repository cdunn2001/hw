Extract sts.h5

  $ outPrefix="softball_snr-50"
  $ bazFile="/pbi/dept/primary/sim/kestrel/kestrel-test-metrics/prod.baz"
  $ baz2bam --fullHQ -o ${outPrefix} -m $TESTDIR/data/metadata.xml ${bazFile} --silent --whitelistZmwId=0-199 --enableBarcodedAdapters=False

Compare sts.h5

  $ stsTool ${outPrefix}.sts.h5 | head -5
  NumBases,ReadLength,Loading,Productivity,MedianInsertLength,InsertReadLength,ReadType,LoopOnly,ReadScore,HQRegionStart,HQRegionEnd,HQRegionStartTime,HQRegionEndTime,HQRegionScore,BaseRate,BaseWidth,BaseIpd,LocalBaseRate,NumPulses,PulseRate,PulseWidth,Pausiness,IsControl,ControlReadLength,ControlReadAccuracy,BaseFraction,HQRegionSnrMean,SnrMean,HQPkmid,InsertionCounts,InsertionLengths,HQBaselineLevel,HQBaselineStd,BaselineLevel,BaselineStd,DyeAngle,HQChannelMinSnr,HoleXY,HoleNumber,UnitFeature,HoleType
  1614,1614,1,1,4294967295,1614,1,0,0.8,0,1614,0,532,0.8,2.93157,0.202446,0.129843,3.01016,1575,2.95786,0.200829,0.000619579,0,4294967295,nan,0.254647/0.244114/0.243494/0.257745,12.8633/17.7599/5.04999/8.12499,12.8633/17.7599/5.04999/8.12499,185.212/255.715/72.7119/116.987,1/0/0/0,1614/0/0/0,-1.92188,14.3984,-1.92188,14.3984,-1/-1/-1/-1,4.67948,0/0,0,1,0
  1656,1656,1,1,4294967295,1656,1,0,0.8,0,1656,0,532,0.8,3.0142,0.192935,0.129843,3.09886,1617,3.03673,0.191672,0.000603865,0,4294967295,nan,0.253623/0.236111/0.267512/0.242754,12.7902/18.009/5.01/8.03915,12.7902/18.009/5.01/8.03915,184.059/259.16/72.097/115.688,1/0/0/0,1656/0/0/0,-1.5957,14.3906,-1.5957,14.3906,-1/-1/-1/-1,4.86372,0/0,1,1,0
  1627,1627,1,1,4294967295,1627,1,0,0.8,0,1627,0,532,0.8,2.94283,0.201677,0.129843,3.01714,1581,2.96913,0.200147,0.000614628,0,4294967295,nan,0.261832/0.241549/0.241549/0.255071,12.7601/18.2075/4.99517/8.0142,12.7601/18.2075/4.99517/8.0142,183.227/261.449/71.7275/115.079,1/0/0/0,1627/0/0/0,-2.52539,14.3594,-2.52539,14.3594,-1/-1/-1/-1,4.99739,0/0,2,1,0
  1588,1588,1,1,4294967295,1588,1,0,0.8,0,1588,0,532,0.8,2.87523,0.20601,0.14427,2.85561,1544,2.89964,0.204468,0.000629723,0,4294967295,nan,0.263854/0.27204/0.223552/0.240554,12.6923/18.5108/4.9152/7.92016,12.6923/18.5108/4.9152/7.92016,183.145/267.105/70.9248/114.285,1/0/0/0,1588/0/0/0,-3.53906,14.4297,-3.53906,14.4297,-1/-1/-1/-1,5.01508,0/0,3,1,0
  $ stsTool ${outPrefix}.sts.h5 | tail -5
  1636,1636,1,1,4294967295,1636,1,0,0.8,0,1636,0,532,0.8,3.00293,0.193228,0.129843,3.09606,1612,3.02734,0.191752,0.000611247,0,4294967295,nan,0.25/0.248778/0.257335/0.243888,12.8584/18.9252/5.01249/8.17713,12.8584/18.9252/5.01249/8.17713,183.835/270.571/71.663/116.907,1/0/0/0,1636/0/0/0,-2.87891,14.2969,-2.87891,14.2969,-1/-1/-1/-1,4.92971,0/0,195,1,0
  1616,1616,1,1,4294967295,1616,1,0,0.8,0,1616,0,532,0.8,2.94847,0.19799,0.14427,2.92252,1593,2.99166,0.195411,0.000618812,0,4294967295,nan,0.235149/0.25495/0.24505/0.264851,12.7159/18.7821/4.98687/8.02977,12.7159/18.7821/4.98687/8.02977,183.785/271.46/72.0759/116.055,1/0/0/0,1616/0/0/0,-1.96777,14.4531,-1.96777,14.4531,-1/-1/-1/-1,5.04524,0/0,196,1,0
  1584,1584,1,1,4294967295,1584,1,0,0.8,0,1584,0,532,0.8,2.89588,0.207192,0.129843,2.96778,1547,2.90527,0.206564,0.000631313,0,4294967295,nan,0.247475/0.248106/0.244949/0.25947,12.5592/17.9917/4.91057/7.96099,12.5592/17.9917/4.91057/7.96099,182.992/262.144/71.5486/115.994,1/0/0/0,1584/0/0/0,-2.63477,14.5703,-2.63477,14.5703,-1/-1/-1/-1,4.6294,0/0,197,1,0
  1612,1612,1,1,4294967295,1612,1,0,0.8,0,1612,0,532,0.8,2.94096,0.204072,0.129843,2.9955,1580,2.96725,0.202428,0.000620347,0,4294967295,nan,0.246278/0.256203/0.240074/0.257444,12.6423/18.7532/4.94126/7.95627,12.6423/18.7532/4.94126/7.95627,182.523/270.75/71.3395/114.869,1/0/0/0,1612/0/0/0,-3.28125,14.4375,-3.28125,14.4375,-1/-1/-1/-1,4.96311,0/0,198,1,0
  1607,1607,1,1,4294967295,1607,1,0,0.8,0,1607,0,532,0.8,2.90152,0.205321,0.129843,2.98434,1560,2.92969,0.203561,0.000622278,0,4294967295,nan,0.260112/0.23771/0.250778/0.2514,12.8984/18.8777/5.00981/8.14662,12.8984/18.8777/5.00981/8.14662,185.414/271.367/72.0161/117.108,1/0/0/0,1607/0/0/0,-2.82812,14.375,-2.82812,14.375,-1/-1/-1/-1,4.82229,0/0,199,1,0

Extract sts.h5

  $ baz2bam -Q $TESTDIR/data/hqregions.fasta -o ${outPrefix}-2 -m $TESTDIR/data/metadata.xml ${bazFile} --silent  --whitelistZmwId=0-199 --enableBarcodedAdapters=False

Compare sts.h5

  $ stsTool ${outPrefix}-2.sts.h5 | head -5
  NumBases,ReadLength,Loading,Productivity,MedianInsertLength,InsertReadLength,ReadType,LoopOnly,ReadScore,HQRegionStart,HQRegionEnd,HQRegionStartTime,HQRegionEndTime,HQRegionScore,BaseRate,BaseWidth,BaseIpd,LocalBaseRate,NumPulses,PulseRate,PulseWidth,Pausiness,IsControl,ControlReadLength,ControlReadAccuracy,BaseFraction,HQRegionSnrMean,SnrMean,HQPkmid,InsertionCounts,InsertionLengths,HQBaselineLevel,HQBaselineStd,BaselineLevel,BaselineStd,DyeAngle,HQChannelMinSnr,HoleXY,HoleNumber,UnitFeature,HoleType
  1614,500,2,1,4294967295,500,3,0,0.8,500,1000,163,327,0.8,2.93579,0.20344,0.14427,2.87835,485,2.96021,0.20192,0,0,4294967295,nan,0.25/0.25/0.25/0.25,13.2374/17.2741/5.15605/8.32693,12.8633/17.7599/5.04999/8.12499,186.358/243.187/72.5875/117.228,1/0/0/0,1614/0/0/0,-0.680176,14.0781,-1.92188,14.3984,-1/-1/-1/-1,5.07488,0/0,0,1,0
  1656,500,2,1,4294967295,500,3,0,0.8,500,1000,163,327,0.8,3.00293,0.192738,0.158696,2.84805,494,3.01514,0.192124,0,0,4294967295,nan,0.278/0.238/0.262/0.222,12.6031/18.4297/4.89779/7.90053,12.7902/18.009/5.01/8.03915,185.896/271.839/72.2423/116.533,1/0/0/0,1656/0/0/0,0.0466614,14.75,-1.5957,14.3906,-1/-1/-1/-1,4.99713,0/0,1,1,0
  1627,500,2,1,4294967295,500,3,0,0.8,500,1000,163,327,0.8,3.00293,0.205383,0.129843,2.98538,495,3.02124,0.20441,0,0,4294967295,nan,0.238/0.232/0.232/0.298,12.4046/18.4616/4.7883/7.77243,12.7601/18.2075/4.99517/8.0142,181.708/270.433/70.1412/113.854,1/0/0/0,1627/0/0/0,-3.36328,14.6484,-2.52539,14.3594,-1/-1/-1/-1,4.88282,0/0,2,1,0
  1588,500,2,1,4294967295,500,3,0,0.8,500,1000,163,327,0.8,2.89917,0.207832,0.14427,2.84242,477,2.91138,0.20705,0,0,4294967295,nan,0.248/0.266/0.228/0.258,12.4824/18.2895/4.77879/7.74618,12.6923/18.5108/4.9152/7.92016,183.433/268.77/70.2259/113.833,1/0/0/0,1588/0/0/0,-3.53906,14.6953,-3.53906,14.4297,-1/-1/-1/-1,4.94307,0/0,3,1,0
  $ stsTool ${outPrefix}-2.sts.h5 | tail -5
  1636,500,2,1,4294967295,500,3,0,0.8,500,1000,163,327,0.8,3.02734,0.189399,0.14427,2.99958,499,3.04565,0.188435,0,0,4294967295,nan,0.284/0.246/0.218/0.252,12.843/18.9272/5.02219/8.09704,12.8584/18.9252/5.01249/8.17713,183.816/270.896/71.8801/115.889,1/0/0/0,1636/0/0/0,-2.36523,14.3125,-2.87891,14.2969,-1/-1/-1/-1,5.0644,0/0,195,1,0
  1616,500,2,1,4294967295,500,3,0,0.8,500,1000,163,327,0.8,2.84424,0.200516,0.14427,2.90278,474,2.89307,0.197553,0,0,4294967295,nan,0.264/0.26/0.24/0.236,12.5905/18.4912/4.88146/7.96369,12.7159/18.7821/4.98687/8.02977,184.628/271.156/71.582/116.78,1/0/0/0,1616/0/0/0,-1.96777,14.6641,-1.96777,14.4531,-1/-1/-1/-1,5.10096,0/0,196,1,0
  1584,500,2,1,4294967295,500,3,0,0.8,500,1000,163,327,0.8,3.00293,0.201834,0.129843,3.01735,494,3.01514,0.20103,0,0,4294967295,nan,0.26/0.23/0.264/0.246,12.0447/16.9984/4.73701/7.57711,12.5592/17.9917/4.91057/7.96099,183.588/259.093/72.2023/115.492,1/0/0/0,1584/0/0/0,-2.0957,15.2422,-2.63477,14.5703,-1/-1/-1/-1,4.30432,0/0,197,1,0
  1612,500,2,1,4294967295,500,3,0,0.8,500,1000,163,327,0.8,2.96631,0.204472,0.129843,2.99352,491,2.99683,0.202612,0,0,4294967295,nan,0.244/0.24/0.23/0.286,12.0825/17.9231/4.69686/7.6497,12.6423/18.7532/4.94126/7.95627,182.276/270.387/70.8565/115.403,1/0/0/0,1612/0/0/0,-3.58203,15.0859,-3.28125,14.4375,-1/-1/-1/-1,4.73139,0/0,198,1,0
  1607,500,2,1,4294967295,500,3,0,0.8,500,1000,163,327,0.8,2.86865,0.209755,0.129843,2.94692,476,2.90527,0.207361,0,0,4294967295,nan,0.264/0.224/0.25/0.262,12.5964/18.5498/4.84733/7.96631,12.8984/18.8777/5.00981/8.14662,184.419/271.581/70.968/116.632,1/0/0/0,1607/0/0/0,-2.36719,14.6406,-2.82812,14.375,-1/-1/-1/-1,4.53674,0/0,199,1,0

Run with diagnostic datasets turned on

  $ outPrefix="softball_snr-50_diag"
  $ baz2bam --fullHQ --diagStsH5 -o ${outPrefix} -m $TESTDIR/data/metadata.xml --adapters $TESTDIR/data/adapter.fasta ${bazFile} --silent --whitelistZmwId=0-199 --enableBarcodedAdapters=False

  $ h5ls ${outPrefix}.sts.h5/VsMF
  BaseRate                 Dataset {200, 15}
  BaseWidth                Dataset {200, 15}
  BaselineLevel            Dataset {200, 15, 1}
  BaselineStd              Dataset {200, 15, 1}
  NumFrames                Dataset {200, 15}
  Pkmid                    Dataset {200, 15, 4}
  PulseRate                Dataset {200, 15}
  PulseWidth               Dataset {200, 15}
  SnrMean                  Dataset {200, 15, 4}
  TraceAutoCorr            Dataset {200, 15}
