Extract sts.h5

  $ outPrefix="softball_snr-50"
  $ bazFile="/pbi/dept/primary/sim/kestrel/kestrel-test-expmetadata/prod.baz"
  $ baz2bam --fullHQ -o ${outPrefix} -m $TESTDIR/data/metadata.xml ${bazFile} --silent --whitelistZmwId=0-199 --enableBarcodedAdapters=False

Compare sts.h5

  $ stsTool ${outPrefix}.sts.h5 | head -5
  NumBases,ReadLength,Loading,Productivity,MedianInsertLength,InsertReadLength,ReadType,LoopOnly,ReadScore,HQRegionStart,HQRegionEnd,HQRegionStartTime,HQRegionEndTime,HQRegionScore,BaseRate,BaseWidth,BaseIpd,LocalBaseRate,NumPulses,PulseRate,PulseWidth,Pausiness,IsControl,ControlReadLength,ControlReadAccuracy,BaseFraction,HQRegionSnrMean,SnrMean,HQPkmid,InsertionCounts,InsertionLengths,HQBaselineLevel,HQBaselineStd,BaselineLevel,BaselineStd,DyeAngle,HQChannelMinSnr,HoleXY,HoleNumber,UnitFeature,HoleType
  1621,1621,1,1,4294967295,1621,1,0,0.8,0,1621,0,532,0.8,2.94283,0.201651,0.129843,3.01738,1585,2.97664,0.199611,0.000616903,0,4294967295,nan,0.249846/0.242443/0.25108/0.256632,5.27248/7.63356/2.06643/3.32933,5.27248/7.63356/2.06643/3.32933,185.196/268.129/72.5834/116.943,1/0/0/0,1621/0/0/0,-19.0312,35.125,-19.0312,35.125,-1/-1/-1/-1,2.12313,0/0,0,1,0
  1660,1660,1,1,4294967295,1660,1,0,0.8,0,1660,0,532,0.8,3.02171,0.192801,0.129843,3.10015,1625,3.05176,0.191131,0.00060241,0,4294967295,nan,0.25241/0.23012/0.273494/0.243976,4.76048/6.93785/1.86448/2.9935,4.76048/6.93785/1.86448/2.9935,184.022/268.191/72.0737/115.717,1/0/0/0,1660/0/0/0,-5.35938,38.6562,-5.35938,38.6562,-1/-1/-1/-1,2.02841,0/0,1,1,0
  1634,1634,1,1,4294967295,1634,1,0,0.8,0,1634,0,532,0.8,2.95598,0.200998,0.129843,3.02333,1591,2.98791,0.199197,0.000611995,0,4294967295,nan,0.261322/0.238678/0.247246/0.252754,4.90169/7.22579/1.91889/3.08289,4.90169/7.22579/1.91889/3.08289,183.201/270.064/71.7184/115.223,1/0/0/0,1634/0/0/0,-11.8594,37.375,-11.8594,37.375,-1/-1/-1/-1,2.05451,0/0,2,1,0
  1590,1590,1,1,4294967295,1590,1,0,0.8,0,1590,0,532,0.8,2.87898,0.205842,0.14427,2.85698,1551,2.91279,0.203713,0.000628931,0,4294967295,nan,0.261006/0.271069/0.225786/0.242138,6.01179/8.88553/2.32563/3.75244,6.01179/8.88553/2.32563/3.75244,183.078/270.592/70.8227/114.273,1/0/0/0,1590/0/0/0,-19.2031,30.4531,-19.2031,30.4531,-1/-1/-1/-1,2.49618,0/0,3,1,0
  $ stsTool ${outPrefix}.sts.h5 | tail -5
  1637,1637,1,1,4294967295,1637,1,0,0.8,0,1637,0,532,0.8,3.00669,0.193134,0.129843,3.09696,1618,3.03861,0.191302,0.000610874,0,4294967295,nan,0.248015/0.247404/0.259621/0.24496,5.53839/8.148/2.15102/3.51228,5.53839/8.148/2.15102/3.51228,184.152/270.921/71.5215/116.783,1/0/0/0,1637/0/0/0,-12.7109,33.25,-12.7109,33.25,-1/-1/-1/-1,2.5604,0/0,195,1,0
  1619,1619,1,1,4294967295,1619,1,0,0.8,0,1619,0,532,0.8,2.9541,0.197763,0.14427,2.92446,1599,3.00293,0.194892,0.000617665,0,4294967295,nan,0.23533/0.250772/0.248919/0.264978,5.62757/8.31312/2.20404/3.55193,5.62757/8.31312/2.20404/3.55193,183.775/271.475/71.9758/115.993,1/0/0/0,1619/0/0/0,-14.1875,32.6562,-14.1875,32.6562,-1/-1/-1/-1,2.53596,0/0,196,1,0
  1606,1606,1,1,4294967295,1606,1,0,0.8,0,1606,0,532,0.8,2.93344,0.204414,0.129843,2.99244,1575,2.95786,0.202904,0.000622665,0,4294967295,nan,0.250311/0.229763/0.265878/0.254047,4.46254/6.25381/1.6942/2.7557,4.46254/6.25381/1.6942/2.7557,193.005/270.477/73.2743/119.184,1/0/0/0,1606/0/0/0,-18.4062,43.25,-18.4062,43.25,-1/-1/-1/-1,1.46225,0/0,197,1,0
  1616,1616,1,1,4294967295,1616,1,0,0.8,0,1616,0,532,0.8,2.94847,0.203584,0.129843,2.99988,1585,2.97664,0.201893,0.000618812,0,4294967295,nan,0.246906/0.251856/0.244431/0.256807,5.89992/8.75407/2.30426/3.70952,5.89992/8.75407/2.30426/3.70952,182.529/270.829/71.2879/114.763,1/0/0/0,1616/0/0/0,-17.1719,30.9375,-17.1719,30.9375,-1/-1/-1/-1,2.5464,0/0,198,1,0
  1613,1613,1,1,4294967295,1613,1,0,0.8,0,1613,0,532,0.8,2.91466,0.204518,0.129843,2.9915,1569,2.94659,0.202585,0.000619963,0,4294967295,nan,0.270924/0.219467/0.262244/0.247365,5.01037/7.13786/1.92628/3.14635,5.01037/7.13786/1.92628/3.14635,190.864/271.908/73.3792/119.856,1/0/0/0,1613/0/0/0,-23.9688,38.0938,-23.9688,38.0938,-1/-1/-1/-1,1.61236,0/0,199,1,0

Extract sts.h5

  $ baz2bam -Q $TESTDIR/data/hqregions.fasta -o ${outPrefix}-2 -m $TESTDIR/data/metadata.xml ${bazFile} --silent  --whitelistZmwId=0-199 --enableBarcodedAdapters=False

Compare sts.h5

  $ stsTool ${outPrefix}-2.sts.h5 | head -5
  NumBases,ReadLength,Loading,Productivity,MedianInsertLength,InsertReadLength,ReadType,LoopOnly,ReadScore,HQRegionStart,HQRegionEnd,HQRegionStartTime,HQRegionEndTime,HQRegionScore,BaseRate,BaseWidth,BaseIpd,LocalBaseRate,NumPulses,PulseRate,PulseWidth,Pausiness,IsControl,ControlReadLength,ControlReadAccuracy,BaseFraction,HQRegionSnrMean,SnrMean,HQPkmid,InsertionCounts,InsertionLengths,HQBaselineLevel,HQBaselineStd,BaselineLevel,BaselineStd,DyeAngle,HQChannelMinSnr,HoleXY,HoleNumber,UnitFeature,HoleType
  1621,500,2,2,4294967295,500,3,0,0,500,1000,163,327,0,2.93579,0.203301,0.14427,2.8795,486,2.96631,0.201437,0,0,4294967295,nan,0.248/0.246/0.258/0.248,5.30732/7.62884/2.06522/3.34033,5.27248/7.63356/2.06643/3.32933,186.42/267.963/72.5409/117.329,1/0/0/0,1621/0/0/0,-17.7188,35.125,-19.0312,35.125,-1/-1/-1/-1,2.1352,0/0,0,1,0
  1660,500,2,2,4294967295,500,3,0,0,500,1000,163,327,0,3.00293,0.193149,0.14427,2.96621,495,3.02124,0.192186,0,0,4294967295,nan,0.276/0.236/0.262/0.226,4.80656/7.03415/1.86646/3.01536,4.76048/6.93785/1.86448/2.9935,185.804/271.914/72.1503/116.563,1/0/0/0,1660/0/0/0,-5.10156,38.6562,-5.35938,38.6562,-1/-1/-1/-1,1.94966,0/0,1,1,0
  1634,500,2,2,4294967295,500,3,0,0,500,1000,163,327,0,3.02734,0.203861,0.129843,2.99901,499,3.04565,0.202923,0,0,4294967295,nan,0.238/0.224/0.24/0.298,4.86042/7.23357/1.87757/3.05233,4.90169/7.22579/1.91889/3.08289,181.658/270.355/70.1743/114.081,1/0/0/0,1634/0/0/0,-8.35938,37.375,-11.8594,37.375,-1/-1/-1/-1,1.95968,0/0,2,1,0
  1590,500,2,2,4294967295,500,3,0,0,500,1000,163,327,0,2.89917,0.207674,0.14427,2.8437,478,2.91748,0.206557,0,0,4294967295,nan,0.242/0.266/0.23/0.262,6.0203/8.83135/2.30216/3.73701,6.01179/8.88553/2.32563/3.75244,183.337/268.942/70.108/113.804,1/0/0/0,1590/0/0/0,-17.8281,30.4531,-19.2031,30.4531,-1/-1/-1/-1,2.437,0/0,3,1,0
  $ stsTool ${outPrefix}-2.sts.h5 | tail -5
  1637,500,2,2,4294967295,500,3,0,0,500,1000,163,327,0,3.02734,0.189611,0.14427,2.99767,503,3.07007,0.18747,0,0,4294967295,nan,0.282/0.246/0.218/0.254,5.52258/8.14914/2.15667/3.48163,5.53839/8.148/2.15102/3.51228,183.626/270.959/71.7093/115.764,1/0/0/0,1637/0/0/0,-10.625,33.25,-12.7109,33.25,-1/-1/-1/-1,2.26789,0/0,195,1,0
  1619,500,2,2,4294967295,500,3,0,0,500,1000,163,327,0,2.85645,0.19973,0.14427,2.90942,478,2.91748,0.196126,0,0,4294967295,nan,0.266/0.256/0.242/0.236,5.65085/8.30515/2.19166/3.5727,5.62757/8.31312/2.20404/3.55193,184.536/271.215/71.5712/116.671,1/0/0/0,1619/0/0/0,-12.6562,32.6562,-14.1875,32.6562,-1/-1/-1/-1,2.32347,0/0,196,1,0
  1606,500,2,2,4294967295,500,3,0,0,500,1000,163,327,0,3.11279,0.193507,0.115416,3.23948,515,3.14331,0.191784,0,0,4294967295,nan,0.27/0.182/0.314/0.234,4.55465/5.90878/1.67591/2.72533,4.46254/6.25381/1.6942/2.7557,210.795/273.466/77.5632/126.132,1/0/0/0,1606/0/0/0,-12.5078,46.2812,-18.4062,43.25,-1/-1/-1/-1,1.76869,0/0,197,1,0
  1616,500,2,2,4294967295,500,3,0,0,500,1000,163,327,0,2.96631,0.204322,0.129843,2.99486,491,2.99683,0.202531,0,0,4294967295,nan,0.244/0.234/0.234/0.288,5.89113/8.73977/2.28949/3.72522,5.89992/8.75407/2.30426/3.70952,182.257/270.387/70.8312/115.249,1/0/0/0,1616/0/0/0,-12.7031,30.9375,-17.1719,30.9375,-1/-1/-1/-1,2.4004,0/0,198,1,0
  1613,500,2,2,4294967295,500,3,0,0,500,1000,163,327,0,2.88696,0.208256,0.129843,2.95999,479,2.92358,0.205906,0,0,4294967295,nan,0.29/0.18/0.282/0.248,4.98263/6.78929/1.87879/3.10663,5.01037/7.13786/1.92628/3.14635,200.862/273.693/75.7388/125.236,1/0/0/0,1613/0/0/0,-16.6875,40.3125,-23.9688,38.0938,-1/-1/-1/-1,1.98939,0/0,199,1,0

Run with diagnostic datasets turned on

  $ outPrefix="softball_snr-50_diag"
  $ baz2bam --fullHQ --diagStsH5 -o ${outPrefix} -m $TESTDIR/data/metadata.xml --adapters $TESTDIR/data/adapter.fasta ${bazFile} --silent --whitelistZmwId=0-199 --enableBarcodedAdapters=False

  $ h5ls ${outPrefix}.sts.h5/VsMF
  BaseRate                 Dataset {200, 15}
  BaseWidth                Dataset {200, 15}
  BaselineLevel            Dataset {200, 15, 1}
  BaselineStd              Dataset {200, 15, 1}
  NumFrames                Dataset {200, 15}
  Pkmid                    Dataset {200, 15, 4}
  PulseRate                Dataset {200, 15}
  PulseWidth               Dataset {200, 15}
  SnrMean                  Dataset {200, 15, 4}
  TraceAutoCorr            Dataset {200, 15}
