Extract sts.h5

  $ outPrefix="softball_snr-50"
  $ bazFile="/pbi/dept/primary/sim/kestrel/kestrel-test-expmetadata/prod.baz"
  $ baz2bam --fullHQ -o ${outPrefix} -m $TESTDIR/data/metadata.xml ${bazFile} --silent --whitelistZmwId=0-199 --enableBarcodedAdapters=False

Compare sts.h5

  $ stsTool ${outPrefix}.sts.h5 | head -5
  NumBases,ReadLength,Loading,Productivity,MedianInsertLength,InsertReadLength,ReadType,LoopOnly,ReadScore,HQRegionStart,HQRegionEnd,HQRegionStartTime,HQRegionEndTime,HQRegionScore,BaseRate,BaseWidth,BaseIpd,LocalBaseRate,NumPulses,PulseRate,PulseWidth,Pausiness,IsControl,ControlReadLength,ControlReadAccuracy,BaseFraction,HQRegionSnrMean,SnrMean,HQPkmid,InsertionCounts,InsertionLengths,HQBaselineLevel,HQBaselineStd,BaselineLevel,BaselineStd,DyeAngle,HQChannelMinSnr,HoleXY,HoleNumber,UnitFeature,HoleType
  1618,1618,1,1,4294967295,1618,1,0,0.8,0,1618,0,532,0.8,2.94096,0.201807,0.129843,3.01596,1584,2.97476,0.199768,0.000618047,0,4294967295,nan,0.250309/0.242274/0.250309/0.257108,5.27271/7.63195/2.06611/3.32898,5.27271/7.63195/2.06611/3.32898,185.204/268.072/72.5721/116.93,1/0/0/0,1618/0/0/0,-19.0312,35.125,-19.0312,35.125,-1/-1/-1/-1,2.12259,0/0,0,1,0
  1660,1660,1,1,4294967295,1660,1,0,0.8,0,1660,0,532,0.8,3.02171,0.192807,0.129843,3.10008,1625,3.05176,0.191137,0.00060241,0,4294967295,nan,0.25/0.231325/0.273494/0.245181,4.76345/6.93785/1.86463/2.99594,4.76345/6.93785/1.86463/2.99594,184.137/268.191/72.0798/115.812,1/0/0/0,1660/0/0/0,-5.38281,38.6562,-5.38281,38.6562,-1/-1/-1/-1,2.02903,0/0,1,1,0
  1634,1634,1,1,4294967295,1634,1,0,0.8,0,1634,0,532,0.8,2.95598,0.200997,0.129843,3.02334,1591,2.98791,0.199196,0.000611995,0,4294967295,nan,0.261322/0.238678/0.247246/0.252754,4.8976/7.21975/1.91722/3.08032,4.8976/7.21975/1.91722/3.08032,183.201/270.064/71.7159/115.223,1/0/0/0,1634/0/0/0,-11.8281,37.4062,-11.8281,37.4062,-1/-1/-1/-1,2.05429,0/0,2,1,0
  1590,1590,1,1,4294967295,1590,1,0,0.8,0,1590,0,532,0.8,2.87898,0.205848,0.14427,2.85692,1551,2.91279,0.203719,0.000628931,0,4294967295,nan,0.261006/0.271069/0.225786/0.242138,6.01118/8.88553/2.32563/3.75208,6.01118/8.88553/2.32563/3.75208,183.059/270.592/70.8227/114.263,1/0/0/0,1590/0/0/0,-19.2031,30.4531,-19.2031,30.4531,-1/-1/-1/-1,2.49593,0/0,3,1,0
  $ stsTool ${outPrefix}.sts.h5 | tail -5
  1638,1638,1,1,4294967295,1638,1,0,0.8,0,1638,0,532,0.8,3.00856,0.193088,0.129843,3.0974,1618,3.03861,0.191356,0.000610501,0,4294967295,nan,0.248474/0.247253/0.260073/0.2442,5.53779/8.14727/2.15125/3.51156,5.53779/8.14727/2.15125/3.51156,184.131/270.897/71.5289/116.759,1/0/0/0,1638/0/0/0,-12.7109,33.25,-12.7109,33.25,-1/-1/-1/-1,2.56043,0/0,195,1,0
  1619,1619,1,1,4294967295,1619,1,0,0.8,0,1619,0,532,0.8,2.9541,0.197776,0.14427,2.92435,1599,3.00293,0.194904,0.000617665,0,4294967295,nan,0.23533/0.250772/0.248919/0.264978,5.62753/8.31312/2.20404/3.55187,5.62753/8.31312/2.20404/3.55187,183.774/271.475/71.9758/115.991,1/0/0/0,1619/0/0/0,-14.2031,32.6562,-14.2031,32.6562,-1/-1/-1/-1,2.53594,0/0,196,1,0
  1586,1586,1,1,4294967295,1586,1,0,0.8,0,1586,0,532,0.8,2.89588,0.207404,0.129843,2.96591,1557,2.92405,0.205573,0.000630517,0,4294967295,nan,0.245902/0.245271/0.252207/0.25662,4.23426/6.24101/1.65364/2.69045,4.23426/6.24101/1.65364/2.69045,183/269.729/71.4683/116.278,1/0/0/0,1586/0/0/0,-18.8281,43.2188,-18.8281,43.2188,-1/-1/-1/-1,1.42548,0/0,197,1,0
  1615,1615,1,1,4294967295,1615,1,0,0.8,0,1615,0,532,0.8,2.94659,0.203804,0.129843,2.99791,1584,2.97476,0.202103,0.000619195,0,4294967295,nan,0.247059/0.252012/0.243963/0.256966,5.89943/8.75407/2.30361/3.70839,5.89943/8.75407/2.30361/3.70839,182.513/270.829/71.268/114.728,1/0/0/0,1615/0/0/0,-17.1562,30.9375,-17.1562,30.9375,-1/-1/-1/-1,2.54769,0/0,198,1,0
  1611,1611,1,1,4294967295,1611,1,0,0.8,0,1611,0,532,0.8,2.91091,0.20492,0.129843,2.98791,1567,2.94283,0.202987,0.000620732,0,4294967295,nan,0.265673/0.230912/0.252638/0.250776,4.86772/7.12651/1.88675/3.06968,4.86772/7.12651/1.88675/3.06968,185.43/271.476/71.8733/116.936,1/0/0/0,1611/0/0/0,-23.9844,38.0938,-23.9844,38.0938,-1/-1/-1/-1,1.57937,0/0,199,1,0

Extract sts.h5

  $ baz2bam -Q $TESTDIR/data/hqregions.fasta -o ${outPrefix}-2 -m $TESTDIR/data/metadata.xml ${bazFile} --silent  --whitelistZmwId=0-199 --enableBarcodedAdapters=False

Compare sts.h5

  $ stsTool ${outPrefix}-2.sts.h5 | head -5
  NumBases,ReadLength,Loading,Productivity,MedianInsertLength,InsertReadLength,ReadType,LoopOnly,ReadScore,HQRegionStart,HQRegionEnd,HQRegionStartTime,HQRegionEndTime,HQRegionScore,BaseRate,BaseWidth,BaseIpd,LocalBaseRate,NumPulses,PulseRate,PulseWidth,Pausiness,IsControl,ControlReadLength,ControlReadAccuracy,BaseFraction,HQRegionSnrMean,SnrMean,HQPkmid,InsertionCounts,InsertionLengths,HQBaselineLevel,HQBaselineStd,BaselineLevel,BaselineStd,DyeAngle,HQChannelMinSnr,HoleXY,HoleNumber,UnitFeature,HoleType
  1618,500,2,2,4294967295,500,3,0,0,500,1000,163,327,0,2.93579,0.203279,0.14427,2.87968,486,2.96631,0.201416,0,0,4294967295,nan,0.248/0.248/0.258/0.246,5.30732/7.62884/2.06523/3.34033,5.27271/7.63195/2.06611/3.32898,186.42/267.963/72.5413/117.329,1/0/0/0,1618/0/0/0,-17.7188,35.125,-19.0312,35.125,-1/-1/-1/-1,2.13492,0/0,0,1,0
  1660,500,2,2,4294967295,500,3,0,0,500,1000,163,327,0,3.00293,0.193169,0.14427,2.96604,495,3.02124,0.192206,0,0,4294967295,nan,0.274/0.236/0.262/0.228,4.80656/7.03415/1.86646/3.01586,4.76345/6.93785/1.86463/2.99594,185.804/271.914/72.1503/116.582,1/0/0/0,1660/0/0/0,-5.125,38.6562,-5.38281,38.6562,-1/-1/-1/-1,1.94969,0/0,1,1,0
  1634,500,2,2,4294967295,500,3,0,0,500,1000,163,327,0,3.02734,0.203878,0.129843,2.99885,499,3.04565,0.20294,0,0,4294967295,nan,0.238/0.224/0.24/0.298,4.85636/7.22753/1.87579/3.04978,4.8976/7.21975/1.91722/3.08032,181.658/270.355/70.1663/114.081,1/0/0/0,1634/0/0/0,-8.34375,37.4062,-11.8281,37.4062,-1/-1/-1/-1,1.95925,0/0,2,1,0
  1590,500,2,2,4294967295,500,3,0,0,500,1000,163,327,0,2.89917,0.207696,0.14427,2.84352,478,2.91748,0.206579,0,0,4294967295,nan,0.242/0.266/0.23/0.262,6.01933/8.83135/2.30216/3.73701,6.01118/8.88553/2.32563/3.75208,183.307/268.942/70.108/113.804,1/0/0/0,1590/0/0/0,-17.8281,30.4531,-19.2031,30.4531,-1/-1/-1/-1,2.43652,0/0,3,1,0
  $ stsTool ${outPrefix}-2.sts.h5 | tail -5
  1638,500,2,2,4294967295,500,3,0,0,500,1000,163,327,0,3.03345,0.189245,0.14427,3.00097,503,3.07007,0.187432,0,0,4294967295,nan,0.282/0.246/0.218/0.254,5.5226/8.14913/2.15761/3.48163,5.53779/8.14727/2.15125/3.51156,183.626/270.958/71.7405/115.764,1/0/0/0,1638/0/0/0,-10.625,33.25,-12.7109,33.25,-1/-1/-1/-1,2.26837,0/0,195,1,0
  1619,500,2,2,4294967295,500,3,0,0,500,1000,163,327,0,2.85645,0.199751,0.14427,2.90925,478,2.91748,0.196145,0,0,4294967295,nan,0.266/0.256/0.242/0.236,5.65085/8.30514/2.19166/3.5727,5.62753/8.31312/2.20404/3.55187,184.536/271.215/71.5712/116.671,1/0/0/0,1619/0/0/0,-12.6719,32.6562,-14.2031,32.6562,-1/-1/-1/-1,2.32347,0/0,196,1,0
  1586,500,2,2,4294967295,500,3,0,0,500,1000,163,327,0,2.99683,0.202675,0.129843,3.00971,498,3.03955,0.199909,0,0,4294967295,nan,0.26/0.228/0.274/0.238,3.99849/5.88185/1.56873/2.52183,4.23426/6.24101/1.65364/2.69045,183.806/270.381/72.1126/115.926,1/0/0/0,1586/0/0/0,-12.5547,45.9688,-18.8281,43.2188,-1/-1/-1/-1,1.64535,0/0,197,1,0
  1615,500,2,2,4294967295,500,3,0,0,500,1000,163,327,0,2.96631,0.204468,0.129843,2.99356,491,2.99683,0.202674,0,0,4294967295,nan,0.244/0.234/0.232/0.29,5.88947/8.73977/2.28744/3.72332,5.89943/8.75407/2.30361/3.70839,182.205/270.387/70.7677/115.19,1/0/0/0,1615/0/0/0,-12.6719,30.9375,-17.1562,30.9375,-1/-1/-1/-1,2.40009,0/0,198,1,0
  1611,500,2,2,4294967295,500,3,0,0,500,1000,163,327,0,2.87476,0.209357,0.129843,2.95038,477,2.91138,0.207006,0,0,4294967295,nan,0.27/0.218/0.252/0.26,4.57979/6.75196/1.76001/2.89073,4.86772/7.12651/1.88675/3.06968,184.48/271.977/70.8954/116.442,1/0/0/0,1611/0/0/0,-16.6875,40.2812,-23.9844,38.0938,-1/-1/-1/-1,1.8802,0/0,199,1,0

Run with diagnostic datasets turned on

  $ outPrefix="softball_snr-50_diag"
  $ baz2bam --fullHQ --diagStsH5 -o ${outPrefix} -m $TESTDIR/data/metadata.xml --adapters $TESTDIR/data/adapter.fasta ${bazFile} --silent --whitelistZmwId=0-199 --enableBarcodedAdapters=False

  $ h5ls ${outPrefix}.sts.h5/VsMF
  BaseRate                 Dataset {200, 15}
  BaseWidth                Dataset {200, 15}
  BaselineLevel            Dataset {200, 15, 1}
  BaselineStd              Dataset {200, 15, 1}
  NumFrames                Dataset {200, 15}
  Pkmid                    Dataset {200, 15, 4}
  PulseRate                Dataset {200, 15}
  PulseWidth               Dataset {200, 15}
  SnrMean                  Dataset {200, 15, 4}
  TraceAutoCorr            Dataset {200, 15}
